{% extends "base.html" %}
{% block content %}
  <div class="mb-4">
    <h2 class="mb-2">日々の記録</h2>
    <p>
      <small>「記録する」ボタンをクリックすると、特定の日の気分、体調、服用したお薬を記録することができます</small>
    </p>
  </div>
  <div class="row">
    <div class="col-5 col-lg-2 mb-5">
      <a href="{{ url_for('create_daily_log') }}" class="btn btn-custom w-100">記録する</a>
    </div>
  </div>
  <div class="row">
    <div class="col-12 col-lg-7 mb-3">
      <h5 class="mb-2">日々の記録一覧</h5>
      {% if not daily_logs %}
        <small class="text-secondary">記録はまだありません</small>
      {% else %}
        <div class="accordion" id="accordionDailyLog">
          {% for daily_log in daily_logs %}
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed d-flex flex-column align-items-start p-2"
                        type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#collapse{{ loop.index }}"
                        aria-expanded="false"
                        aria-controls="collapse{{ loop.index }}">
                  <span class="pb-1">{{ daily_log.date.strftime("%Y/%m/%d") }}</span>
                  <span>気分:
                    {% for i in range(0, daily_log.mood) %}
                      <img src="{{ url_for('static', filename='images/star_on.png') }}"
                           class="star-display rating-checked"
                           alt="star">
                    {% endfor %}
                    {% if daily_log.mood < 5 %}
                      {% for i in range(daily_log.mood, 5) %}
                        <img src="{{ url_for('static', filename='images/star_on.png') }}"
                             class="star-display"
                             alt="star">
                      {% endfor %}
                    {% endif %}
                    　体調:
                    {% for i in range(0, daily_log.condition) %}
                      <img src="{{ url_for('static', filename='images/star_on.png') }}"
                           class="star-display rating-checked"
                           alt="star">
                    {% endfor %}
                    {% if daily_log.condition < 5 %}
                      {% for i in range(daily_log.condition, 5) %}
                        <img src="{{ url_for('static', filename='images/star_on.png') }}"
                             class="star-display"
                             alt="star">
                      {% endfor %}
                    {% endif %}
                  </span>
                </button>
              </h2>
              <div id="collapse{{ loop.index }}"
                   class="accordion-collapse collapse"
                   data-bs-parent="#accordionDailyLog">
                <div class="accordion-body">
                  <table class="table table-hover mb-0">
                    {% if daily_log.all_doses_zero %}
                      <tr>
                        <td>服用したお薬はありません</td>
                      </tr>
                    {% else %}
                      {% for detail in daily_log.daily_log_details %}
                        {% if not detail.dose == 0.0 %}
                          <tr>
                            <td style="width: 70%;">{{ detail.medicine.name }}</td>
                            <td style="width: 30%">
                              {# 服用した量が1.0など小数点以下が0であれば数値に変換 #}
                              {% if (detail.dose|string).split(".")[1] == "0" %}
                                {{ detail.dose|int }}
                              {% else %}
                                {{ detail.dose }}
                              {% endif %}
                              {{ detail.medicine.taking_unit.value }}
                            </td>
                          </tr>
                        {% endif %}
                      {% endfor %}
                    {% endif %}
                  </table>
                </div>
                <a href="{{ url_for('edit_daily_log', daily_log_id=daily_log.id) }}"
                   class="btn btn-custom btn-sm ms-4 mt-0 mb-3">記録を編集</a>
                <button type="button"
                        class="btn btn-danger btn-sm mx-2 mt-0 mb-3"
                        data-bs-toggle="modal"
                        data-bs-target="#deletingModal">記録を削除</button>
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
{% endblock content %}
