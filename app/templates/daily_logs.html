{% extends "base.html" %}
{% block content %}
  <div class="mb-4">
    <h2 class="mb-2">日々の記録</h2>
    <p>
      <small>「記録する」ボタンをクリックすると、特定の日の気分、体調、服用したお薬を記録することができます</small>
    </p>
  </div>
  <div class="row">
    <div class="col-5 col-lg-2 mb-5">
      <a href="{{ url_for('create_daily_log') }}" class="btn btn-custom w-100">記録する</a>
    </div>
  </div>
  <div class="row">
    <div class="col-12 col-lg-7 mb-3">
      <h5 class="mb-2">日々の記録一覧</h5>
      {% if not daily_logs %}
        <small class="text-secondary">記録はまだありません</small>
      {% else %}
        <div class="accordion" id="accordionDailyLog">
          {% for daily_log in daily_logs %}
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed d-flex flex-column align-items-start p-2"
                        type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#collapse{{ loop.index }}"
                        aria-expanded="false"
                        aria-controls="collapse{{ loop.index }}">
                  <span class="pb-1">{{ daily_log.date.strftime("%Y/%m/%d") }}</span>
                  <span>気分:
                    {% for i in range(0, daily_log.mood) %}
                      <img src="{{ url_for('static', filename='images/star_on.png') }}"
                           class="star-display rating-checked"
                           alt="star">
                    {% endfor %}
                    {% if daily_log.mood < 5 %}
                      {% for i in range(daily_log.mood, 5) %}
                        <img src="{{ url_for('static', filename='images/star_on.png') }}"
                             class="star-display"
                             alt="star">
                      {% endfor %}
                    {% endif %}
                    　体調:
                    {% for i in range(0, daily_log.condition) %}
                      <img src="{{ url_for('static', filename='images/star_on.png') }}"
                           class="star-display rating-checked"
                           alt="star">
                    {% endfor %}
                    {% if daily_log.condition < 5 %}
                      {% for i in range(daily_log.condition, 5) %}
                        <img src="{{ url_for('static', filename='images/star_on.png') }}"
                             class="star-display"
                             alt="star">
                      {% endfor %}
                    {% endif %}
                  </span>
                </button>
              </h2>
              <div id="collapse{{ loop.index }}"
                   class="accordion-collapse collapse"
                   data-bs-parent="#accordionDailyLog">
                <div class="accordion-body">
                  {% if daily_log.all_doses_zero %}
                    服用したお薬はありません
                  {% else %}
                    <ul class="list-group">
                      {% for detail in daily_log.daily_log_details %}
                        <li class="list-group-item">
                          {{ detail.medicine.name }}
                          {# 服用した量が1.0など小数点以下が0であれば数値に変換 #}
                          {% if (detail.dose|string).split(".")[1] == "0" %}
                            {{ detail.dose|int }}
                          {% else %}
                            {{ detail.dose }}
                          {% endif %}
                        </li>
                      {% endfor %}
                    </ul>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
{% endblock content %}
